<!DOCTYPE HTML>

<html lang="ja">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="/src/style.css">

        <title>
            Babel Server
        </title>

        <link rel="icon" href="/img/babel.ico">

        <link rel="icon" href="/img/babel.ico">
    </head>

    <body>
        <div class="wrapper">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <header>
                <div class="header-title">
                    <a href="" style="color: white; text-decoration: none;">
                        Babel Server
                    </a>
                </div>

                <button class="hamburger-menu" onclick="toggleSideMenu()">â˜°</button>
            </header>

            <!-- ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
            <side-menu>
                <div class="side-text">
                    ãƒ¡ãƒ‹ãƒ¥ãƒ¼
                </div>

                <button class="side-button" onclick="location.href='mining-server'">
                    <span class="button-text-ja">
                        æ¡æ˜ã‚µãƒ¼ãƒãƒ¼
                    </span>

                    <span class="button-text-en">
                        Mining Server
                    </span>
                </button>

                <button class="side-button" onclick="location.href='how-to-join'">
                    <span class="button-text-ja">
                        å‚åŠ æ–¹æ³•
                    </span>

                    <span class="button-text-en">
                        How to join
                    </span>
                </button>

                <button class="side-button" onclick="location.href='moderators'">
                    <span class="button-text-ja">
                        æ¨©é™è€…
                    </span>

                    <span class="button-text-en">
                        Moderators
                    </span>
                </button>

                <button class="side-button" onclick="location.href='/announcements'">
                    <span class="button-text-ja">
                        ãŠçŸ¥ã‚‰ã›
                    </span>

                    <span class="button-text-en">
                        Announcements
                    </span>
                </button>

                <button class="side-button" onclick="location.href='recruitment'">
                    <span class="button-text-ja">
                        æ¡ç”¨æƒ…å ±
                    </span>

                    <span class="button-text-en">
                        Recruitment
                    </span>
                </button>

                <button class="side-button" onclick="location.href='contact-us'">
                    <span class="button-text-ja">
                        ãŠå•ã„åˆã‚ã›
                    </span>

                    <span class="button-text-en">
                        Contact Us
                    </span>
                </button>

            </side-menu>

            <div id="overlay"></div>

            <script src="/src/script.js"></script>

            <!-- å†…å®¹éƒ¨åˆ† -->
            <div class="container">
                <div class="slideshow">
                    <div class="img-main main1"></div>
                    <div class="img-main main2"></div>
                    <div class="img-main main3"></div>
                    <div class="img-main main4"></div>
                    <div class="img-main main5"></div>
                    <!-- ä¸­å¤®ã®ãƒ†ã‚­ã‚¹ãƒˆ -->
                    <div class="slideshow-text">
                        <span class="slideshow-text-span">Babel Server</span><br>
                        <span class="slideshow-subtext-span">Since 2018</span>
                    </div>
                </div>

                <a href="announcements">
                    <img alt="announcements-banner" class="img-announcements"  src="img/announcements-banner.png">
                </a>

                <h1>
                    æ¡æ˜ã‚µãƒ¼ãƒãƒ¼æƒ…å ±
                </h1>

                <div id="status-container" class="status-container">
                    <div class="status-mining">
                        <div class="server-status">
                            <span class="status-text">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</span>
                            <span id="connectionStatus" class="status">âš«å–å¾—ä¸­</span>
                        </div>

                        <div class="server-count">
                            <span class="status-text">æ¥ç¶šä¸­ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼:</span>
                            <span id="countText" class="status">âš«å–å¾—ä¸­</span>
                        </div>
                    </div>
                </div>

                <!--suppress ExceptionCaughtLocallyJS -->
                <script>
                    // å¿…è¦ãªå¤‰æ•°ã®å®£è¨€(APIã€æ›´æ–°é »åº¦)
                    const API_ENDPOINT = 'https://api.ma27inranma.com/bs-seichi/api/v0/status';
                    const REFRESH_INTERVAL = 30000;

                    // å¿…è¦ãªå¤‰æ•°ã®å®£è¨€(æ–‡å­—éƒ¨åˆ†)
                    const connectionStatusElement = document.getElementById('connectionStatus');
                    const countTextElement = document.getElementById('countText');

                    async function fetchAndUpdateStatus() {
                        console.log('APIã«æ¥ç¶šã—ã¦ã„ã¾ã™');

                        connectionStatusElement.textContent = 'âš«å–å¾—ä¸­';
                        connectionStatusElement.className = 'status-text-loading';
                        countTextElement.textContent = 'âš«å–å¾—ä¸­';
                        countTextElement.className = 'status-text-loading';

                        // APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                        try {
                            const response = await fetch(API_ENDPOINT);

                            if (response.status === 502) {
                                // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³
                                connectionStatusElement.textContent = 'ğŸ”´ã‚ªãƒ•ãƒ©ã‚¤ãƒ³';
                                connectionStatusElement.className = 'status-text-offline';
                                countTextElement.textContent = '0 / 100 äºº';
                                console.log('APIã«æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸ: ã‚µãƒ¼ãƒãƒ¼ãŒã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã™');
                            } else if(!response.ok) {
                                //ã€€ãã®ä»–ã®è¦å› ã§å¤±æ•—
                                throw new Error(`APIã‹ã‚‰å–å¾—å‡ºæ¥ã¾ã›ã‚“ã§ã—ãŸ (ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status})`);
                            }

                            const data = await response.json();

                            const playerCount = data.connectedPlayers.length
                            countTextElement.textContent = `${playerCount} / 100 äºº`

                            connectionStatusElement.textContent = 'ğŸŸ¢ã‚ªãƒ³ãƒ©ã‚¤ãƒ³';
                            console.log('APIã«æ¥ç¶šã—ã¾ã—ãŸ: æƒ…å ±ã®å–å¾—ãŒå®Œäº†');
                            connectionStatusElement.className = 'status-text-online';

                        } catch (error) {
                            console.error('APIã«æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸ:', error);
                            connectionStatusElement.textContent = 'ğŸŸ£æ¥ç¶šå¤±æ•—';
                            connectionStatusElement.className = 'status-text-error';
                            countTextElement.textContent = 'ğŸŸ£æ¥ç¶šå¤±æ•—';
                            countTextElement.className = 'status-text-error';
                        }
                    }

                    fetchAndUpdateStatus();
                    setInterval(fetchAndUpdateStatus, REFRESH_INTERVAL);

                </script>
            </div>

            <footer>
                <div class="footer-content">
                    <!-- å·¦ã‚«ãƒ©ãƒ ï¼šæ’å‡ºç¢ºç‡ -->
                    <div class="footer-column">
                        <div class="footer-title">
                            æ’å‡ºç¢ºç‡
                        </div>

                        <ul>
                            <li>
                                <a href="probability/cave">
                                    æ´çªŸ
                                </a>
                            </li>

                            <li>
                                <a href="probability/nether">
                                    ãƒã‚¶ãƒ¼
                                </a>
                            </li>

                            <li>
                                <a href="probability/end">
                                    ã‚¨ãƒ³ãƒ‰
                                </a>
                            </li>

                            <li>
                                <a href="probability/ocean">
                                    æµ·
                                </a>
                            </li>

                            <li>
                                <a href="probability/temple">
                                    æµ·åº•ç¥æ®¿
                                </a>
                            </li>

                            <li>
                                <a href="probability/demise">
                                    çµ‚ç„‰
                                </a>
                            </li>

                            <li>
                                <a href="probability/gold">
                                    é»„é‡‘
                                </a>
                            </li>

                            <li>
                                <a href="probability/heaven">
                                    å¤©ç•Œ
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- ä¸­å¤®ã‚«ãƒ©ãƒ ï¼šBabel Server -->
                    <div class="footer-column">
                        <div class="footer-title">
                            Babel Server
                        </div>

                        <ul>
                            <li>
                                <a href="mining-server">
                                    æ¡æ˜ã‚µãƒ¼ãƒãƒ¼
                                </a>
                            </li>

                            <li>
                                <a href="how-to-join">
                                    å‚åŠ æ–¹æ³•
                                </a>
                            </li>

                            <li>
                                <a href="moderators">
                                    æ¨©é™è€…
                                </a>
                            </li>

                            <li>
                                <a href="announcements">
                                    ãŠçŸ¥ã‚‰ã›
                                </a>
                            </li>

                            <li>
                                <a href="recruitment">
                                    æ¡ç”¨æƒ…å ±
                                </a>
                            </li>

                            <li>
                                <a href="contact-us">
                                    ãŠå•ã„åˆã‚ã›
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- å³ã‚«ãƒ©ãƒ ï¼šãã®ä»– -->
                    <div class="footer-column">
                        <div class="footer-title">
                            ãã®ä»–
                        </div>

                        <ul>
                            <li>
                                <a href="others/ranking">
                                    ãƒ©ãƒ³ã‚­ãƒ³ã‚°
                                </a>
                            </li>

                            <li>
                                <a href="others/room">
                                    å€‹äººéƒ¨å±‹
                                </a>
                            </li>

                            <li>
                                <a href="others/about">
                                    ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- ãƒ•ãƒƒã‚¿ãƒ¼æœ€ä¸‹éƒ¨ -->
                <div class="footer-bottom">
                    Babel Server
                </div>
            </footer>
        </div>
    </body>

</html>