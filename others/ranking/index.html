<!DOCTYPE HTML>

<html lang="ja">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../src/style.css">

        <title>
            Babel Server
        </title>
    </head>

    <body>
        <div class="wrapper">
            <!-- ヘッダー -->
            <header>
                <div class="header-title">
                    <a href="../../" style="color: white; text-decoration: none;">
                        Babel Server
                    </a>
                </div>
            </header>

            <!-- サイドメニュー -->
            <side-menu>
                <div class="side-text">
                    メニュー
                </div>

                <button class="side-button" onclick="location.href='../../mining-server'">
                    <span class="button-text-ja">
                        採掘サーバー
                    </span>

                    <span class="button-text-en">
                        Mining Server
                    </span>
                </button>

                <button class="side-button" onclick="location.href='../../how-to-join'">
                            <span class="button-text-ja">
                                参加方法
                            </span>

                    <span class="button-text-en">
                                How to join
                            </span>
                </button>

                <button class="side-button" onclick="location.href='../../moderators'">
                            <span class="button-text-ja">
                                権限者
                            </span>

                    <span class="button-text-en">
                                Moderators
                            </span>
                </button>

                <button class="side-button" onclick="location.href='../../announcements'">
                            <span class="button-text-ja">
                                お知らせ
                            </span>

                    <span class="button-text-en">
                                Announcements
                            </span>
                </button>

                <button class="side-button" onclick="location.href='../../recruitment'">
                            <span class="button-text-ja">
                                採用情報
                            </span>

                    <span class="button-text-en">
                                Recruitment
                            </span>
                </button>

                <button class="side-button" onclick="location.href='../../contact-us'">
                            <span class="button-text-ja">
                                お問い合わせ
                            </span>

                    <span class="button-text-en">
                                Contact Us
                            </span>
                </button>

            </side-menu>

            <!-- 内容部分 -->
            <div class="container">
                <h1>
                    所持金ランキング
                </h1>

                <div id="table-container"></div>

                <script>
                    // 色コード（例：§g、§e、§fなど）を削除する関数
                    function removeColorCodes(str) {
                        return str.replace(/§[a-zA-Z0-9]/g, '').trim();
                    }

                    // 生データからテーブル用のデータを抽出し、テーブルを生成して表示する関数
                    function createTableFromRawData(rawData) {
                        // 取得したデータをデバッグ出力
                        console.log("Raw Data:", rawData);

                        // 改行コードにCRLFにも対応し、空行を除去する
                        const lines = rawData.trim().split(/\r?\n/).filter(line => line.trim() !== "");
                        if (lines.length === 0) {
                            console.log("データがありません。");
                            return;
                        }
                        const headerLabel = removeColorCodes(lines[0]);
                        const dataRows = lines.slice(1);

                        // 各行から名前と数値を抽出
                        const tableData = dataRows.map(row => {
                            const cleanRow = removeColorCodes(row);
                            const parts = cleanRow.split(':');
                            if (parts.length < 2) {
                                console.log("フォーマットエラーの行:", cleanRow);
                                return null;
                            }
                            return {
                                name: parts[0].trim(),
                                money: parts[1].trim()
                            };
                        }).filter(item => item !== null);

                        // テーブルの生成
                        const table = document.createElement('table');
                        const thead = document.createElement('thead');
                        const headerRow = document.createElement('tr');

                        const thName = document.createElement('th');
                        thName.textContent = '名前';
                        const thMoney = document.createElement('th');
                        thMoney.textContent = headerLabel;

                        headerRow.appendChild(thName);
                        headerRow.appendChild(thMoney);
                        thead.appendChild(headerRow);
                        table.appendChild(thead);

                        const tbody = document.createElement('tbody');
                        tableData.forEach(item => {
                            const tr = document.createElement('tr');
                            const tdName = document.createElement('td');
                            tdName.textContent = item.name;
                            const tdMoney = document.createElement('td');
                            tdMoney.textContent = item.money;
                            tr.appendChild(tdName);
                            tr.appendChild(tdMoney);
                            tbody.appendChild(tr);
                        });
                        table.appendChild(tbody);

                        document.getElementById('table-container').appendChild(table);
                    }

                    // DOM読み込み完了後にAPIからデータ取得
                    document.addEventListener('DOMContentLoaded', function() {
                        fetch('https://api.ma27inranma.com/bs-seichi/api/v0/leaderboard', {
                            headers: {
                                'LeaderboardType': 'money'
                            }
                        })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Network response was not ok: ' + response.statusText);
                                }
                                return response.text();
                            })
                            .then(rawData => {
                                createTableFromRawData(rawData);
                            })
                            .catch(error => {
                                console.log('Error fetching leaderboard data:', error);
                            });
                    });
                </script>
            </div>

            <footer>
                <div class="footer-content">
                    <!-- 左カラム：排出確率 -->
                    <div class="footer-column">
                        <div class="footer-title">
                            排出確率
                        </div>

                        <ul>
                            <li>
                                <a href="../../probability/cave">
                                    洞窟
                                </a>
                            </li>

                            <li>
                                <a href="../../probability/nether">
                                    ネザー
                                </a>
                            </li>

                            <li>
                                <a href="../../probability/end">
                                    エンド
                                </a>
                            </li>

                            <li>
                                <a href="../../probability/ocean">
                                    海
                                </a>
                            </li>

                            <li>
                                <a href="../../probability/temple">
                                    海底神殿
                                </a>
                            </li>

                            <li>
                                <a href="../../probability/demise">
                                    終焉
                                </a>
                            </li>

                            <li>
                                <a href="../../probability/gold">
                                    黄金
                                </a>
                            </li>

                            <li>
                                <a href="../../probability/heaven">
                                    天界
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- 中央カラム：Babel Server -->
                    <div class="footer-column">
                        <div class="footer-title">
                            Babel Server
                        </div>

                        <ul>
                            <li>
                                <a href="../../mining-server">
                                    採掘サーバー
                                </a>
                            </li>

                            <li>
                                <a href="../../how-to-join">
                                    参加方法
                                </a>
                            </li>

                            <li>
                                <a href="../../moderators">
                                    権限者
                                </a>
                            </li>

                            <li>
                                <a href="../../announcements">
                                    お知らせ
                                </a>
                            </li>

                            <li>
                                <a href="../../recruitment">
                                    採用情報
                                </a>
                            </li>

                            <li>
                                <a href="../../contact-us">
                                    お問い合わせ
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- 右カラム：その他 -->
                    <div class="footer-column">
                        <div class="footer-title">
                            その他
                        </div>

                        <ul>
                            <li>
                                <a href="../../others/ranking">
                                    ランキング
                                </a>
                            </li>

                            <li>
                                <a href="../../others/room">
                                    個人部屋
                                </a>
                            </li>

                            <li>
                                <a href="../../others/about">
                                    このサイトについて
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- フッター最下部 -->
                <div class="footer-bottom">
                    Babel Server
                </div>
            </footer>
        </div>
    </body>

</html>